<!DOCTYPE html>
<html>
<head>
    <title>登陆小demo</title>
    <link href="../images/tipchildren.ico" rel="icon" type="image/x-ico">
</head>


<!-- Head -->
<head>
    <!--时间小人特效-->
    <div style="width: 288px; height: 136px; overflow: hidden; margin: 0 auto;">
        <embed src="https://cdn.jikewenku.com/honehone_clock_tr.swf"
               quality="high" wmode="transparent"
               type="application/x-shockwave-flash" width="310" height="142">
    </div>


    <!-- Meta-Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">



    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>
    <!-- //Meta-Tags -->
    <!-- Style -->
    <link href="../images/tipchildren.ico" rel="icon" type="image/x-ico">

    <link rel="stylesheet" href="../css/style.css" type="text/css" media="all">
    <script type="text/javascript">
        /*7Core-CN - 网页鼠标点击特效（爱心）*/
        !function (e, t, a) {function r() {for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");requestAnimationFrame(r)}function n() {var t = "function" == typeof e.onclick && e.onclick;e.onclick = function (e) {t && t(), o(e)}}function o(e) {var a = t.createElement("div");a.className = "heart", s.push({el: a,x: e.clientX - 5,y: e.clientY - 5,scale: 1,alpha: 1,color: c()}), t.body.appendChild(a)}function i(e) {var a = t.createElement("style");a.type = "text/css";try {a.appendChild(t.createTextNode(e))} catch (t) {a.styleSheet.cssText = e}t.getElementsByTagName("head")[0].appendChild(a)}function c() {return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"}var s = [];e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {setTimeout(e, 1e3 / 60)}, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()}(window, document);
    </script>

</head>
<!-- //Head -->

<!-- Body -->
<body>

<!--<h1>登陆小demo</h1>-->

<div class="container w3layouts agileits">

    <div class="login w3layouts agileits">
        <h2>登 录</h2>


        <form class="newlogin" method="post" name="myform" action="/login" onsubmit="return loginaa()">
            <span id="nickname_span1" style="color: red"></span><br>
            <input type="text" id="loginusername" Name="username" placeholder="用户名" required >
            <span id="password_span1" style="color: red"></span><br>
            <input type="password" id="loginpassword" Name="password"  placeholder="密码"  required>
            <ul class="tick w3layouts agileits">
                <li>
                    <input type="checkbox" id="brand1" value="" onclick="remember()">
                    <label for="brand1"><span></span>记住密码</label>
                    <span id="label_span" style="color: orange"></span><br>
                </li>
            </ul>
            <div class="send-button w3layouts agileits">
                <input id="login" type="submit" value="登 录">
            </div>
            </form>
        <script src="../js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript">

            function loginaa() {
                var username = $("#loginusername").val();
                var password = $("#loginpassword").val();
                var f = false;
                if(username==''||username==null) {
                    document.getElementById("nickname_span1").innerHTML="用户名不能为空";
                }else if(password==''||password==null){
                    document.getElementById("password_span1").innerHTML="密码不能为空";
                }else {
                    document.getElementById("nickname_span1").innerHTML="";
                    document.getElementById("password_span1").innerHTML="";
                    $.ajax({
                        url:"/login",
                        dataType:"json",
                        data:{"username":username,"password":password},
                        type:"post",
                        success:function (result) {
                            console.log(result);
                            if(result=="success"){
                                    $(location).attr('href','/html/success.html');
                            }else{
                                var msg = ' <div class="alert alert-warning" style="color: red;font-size: 30px">用户名或密码错误！</div>';
                                $('#msg').html(msg);
                                setTimeout(function(){
                                    $('#msg').empty();
                                },2000);
                            }
                        }
                    });
                }
                return f;
            }
            function remember() {
                var brand = $("input:checkbox").is(':checked');
                 console.log(brand);
                 if(brand==false){
                     $("#label_span").html("")
                 }else{
                     $("#label_span").html("请不要在公共场所勾选此选项！")
                 }
            }
        </script>

        <a href="/html/fail.html">忘记密码?</a>
        <div class="social-icons w3layouts agileits">
            <p>- 其他方式登录 -</p>
            <ul>
                <li class="qq"><a href="#">
                    <span class="icons w3layouts agileits"></span>
                    <span class="text w3layouts agileits">QQ</span></a></li>
                <li class="weixin w3ls"><a href="#">
                    <span class="icons w3layouts"></span>
                    <span class="text w3layouts agileits">微信</span></a></li>
                <li class="weibo aits"><a href="#">
                    <span class="icons agileits"></span>
                    <span class="text w3layouts agileits">微博</span></a></li>
                <div class="clear"></div>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
    <div class="register w3layouts agileits">
        <h2>注 册</h2>
        <form id="user-from" action="#" method="post" role="form">
            <span id="nickname_span" style="color: red"></span><br>
            <input type="text" Name="name" id="nickname" placeholder="用户名" required oninput="findname()">
            <span id="password_span" style="color: red"></span><br>
            <input type="password"  Name='password' id="password" placeholder="密码" required oninput="checkPassword()">
            <span id="repassword_span" style="color: red"></span><br>
            <input type="password"  id="repassword" placeholder="确认密码" required oninput="checkRepassword()" >
            <span id="email_span" style="color: red"></span> <br>
            <input type="text" Name="email" placeholder="邮箱" id="email" required oninput="checkEmail()">
            <span id="phone_span" style="color: red"></span> <br>
            <input type="text" Name="phone" placeholder="手机号码" id="phone" required oninput="checkPhone()">
        </form>
        <div class="send-button w3layouts agileits">
            <form>
                <input id="register" type="button" value="免费注册">
            </form>
        </div>
        <div class="clear"></div>
    </div>
    <div id="msg"></div>
    <div class="clear"></div>
</div>
<script type="text/javascript">


     function checkPassword(){
         var password=document.getElementById("password").value;
         var reg=/^[a-zA-Z]\w{5,15}$/;
         var f = reg.test(password);
         if(f==false){
             document.getElementById("password_span").innerHTML="密码格式错误，是由大写字母和数字构成的！";
             return false;
         }else if(password==""||password==null){
             document.getElementById("password_span").innerHTML="密码不能为空！";
             return false;
         }else{
             document.getElementById("password_span").innerHTML="";
             return true;
         }
     }
    function checkRepassword(){
        var password=document.getElementById("password").value;
        var repassword= $("#repassword").val();
        if(password==repassword){
            document.getElementById("repassword_span").innerHTML="";
            return true;
        }else{
            document.getElementById("repassword_span").innerHTML="两次输入密码不一致";
            return false;
        }
    }
    //验证邮箱
    function checkEmail(){
        var email=document.getElementById("email").value;
        //两种引用正则表达式方式
        //var reg = new RegExp("^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$");
        var reg=/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
        var f = reg.test(email);
        var g = false;
        if(f==false){
            document.getElementById("email_span").innerHTML="邮箱格式错误";
            return false;
        }else if(email==""||email==null){
            document.getElementById("email_span").innerHTML="邮箱不能为空";
        }else{
            document.getElementById("email_span").innerHTML="";
            $.ajax({
                // url:"/emails?email="+email,
                url:"/emails/"+email+".com",
                type:"get",
                dataType:"json",
                async:false,//让ajax执行代码顺序同步
                success:function (result) {
                    if(result=='success'){
                        document.getElementById("email_span").innerHTML="邮箱已经被注册！";
                    }else{
                        document.getElementById("email_span").innerHTML="";
                        g = true;
                    }
                }
            });
            return g;
        }
    }
    function checkPhone(){
        var g = false;
        var phone = document.getElementById('phone').value;
        if(phone==""){
            document.getElementById("phone_span").innerHTML="手机不能为空";
        }else if(!(/^1[34578]\d{9}$/.test(phone))){
            document.getElementById("phone_span").innerHTML="手机格式错误";
        }else {
            document.getElementById("phone_span").innerHTML="";
                $.ajax({
                    url:"/phones/"+phone,
                    type:"get",
                    dataType:"json",
                    async:false,//让ajax执行代码顺序同步
                    success:function (result) {
                        if(result=='success'){
                            document.getElementById("phone_span").innerHTML="手机号已被注册！";
                        }else{
                            document.getElementById("phone_span").innerHTML="";
                            g = true;
                        }
                    }
                });
        }
        return g;
    }
    function findname() {
        var f = false;
        var name = $("#nickname").val();
        if(name==""){
            document.getElementById("nickname_span").innerHTML="用户名不能为空";
        }else if(name.length<6||name.length>16){
            document.getElementById("nickname_span").innerHTML="用户名的长度为6-16位";
        }else{
            document.getElementById("nickname_span").innerHTML="";
            $.ajax({
                url:"/users/"+name,
                type:"get",
                dataType:"json",
                async:false,//让ajax执行代码顺序同步
                success:function (result) {
                    if(result=='success'){
                        document.getElementById("nickname_span").innerHTML="此用户名太受欢迎,请更换一个！";
                    }else{
                        document.getElementById("nickname_span").innerHTML="";
                        f = true;
                    }
                }
            });
        }
        return f;
    }
</script>
<script>
      $(function () {
          $("#register").click(function () {
              var f = findname();
              var p = checkPassword();
              var rep = checkRepassword();
              var checkEmail1 = checkEmail();
              var phone = checkPhone();
              var sub = (f&&p&&rep&&checkEmail1&&phone);
                  register(sub);
          });
      });

       function register(boolean) {
           if(boolean==false){

           }else if (boolean==true){
               var jsonForm = $("#user-from").serializeArray();
               var jsonData = {};
               $.each(jsonForm, function (i, v) {
                   jsonData[v.name] = v.value;
               });
               var params = JSON.stringify(jsonData);

               $.ajax({
                   url:"/users",
                   type:"post",
                   data:params,
                   dataType:"json",
                   contentType:"application/json",
                   success:function (result) {
                       if (result == "success"){
                           var msg = ' <div class="alert alert-warning" style="color: green;font-size: 30px">注册成功!欢迎您！</div>';
                           $('#msg').html(msg);
                           setTimeout(function(){
                               $('#msg').empty();
                               $(location).attr('href', '/html/index.html');
                           },1000);

                       }else{
                           var msg = ' <div class="alert alert-warning" style="color: red;font-size: 30px">注册失败！请检查！</div>';
                           $('#msg').html(msg);
                           setTimeout(function(){
                               $('#msg').empty();
                           },2000);
                       }
                   }
               });
           }
       }


</script>
</body>
<!-- 雪花特效 -->
<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://itbyc.com/templets/yang/js/snow.js"></script>
<style type="text/css">.snow-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:100001;}</style>
<div class="snow-container"></div>

</html>